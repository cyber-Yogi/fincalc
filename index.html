<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Bible Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --primary: #435ebe; --bg: #f2f7ff; --text: #25396f; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; }
        .header { margin-bottom: 2rem; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: transform 0.2s; border-top: 5px solid var(--primary); }
        .card:hover { transform: translateY(-5px); }
        .label { font-size: 0.85rem; font-weight: 600; color: #7c8db5; text-transform: uppercase; margin-bottom: 10px; }
        .value { font-size: 1.8rem; font-weight: 800; color: #435ebe; }
        .footer { margin-top: 30px; text-align: center; font-size: 0.8rem; color: #a0aec0; }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 1000; font-weight: bold; }
        .mortgage { color: #dc3545 !important; } /* Red for debt */
    </style>
</head>
<body>

<div id="loading-overlay">Syncing with Financial Bible...</div>

<div class="container">
    <div class="header">
        <h1>Personal Wealth Dashboard</h1>
        <p>Real-time sync from CompiledSanity Excel</p>
    </div>

    <div class="grid">
        <div class="card">
            <div class="label">Total Net Worth</div>
            <div id="nw" class="value">£0</div>
        </div>
        <div class="card">
            <div class="label">SIPP / Pension</div>
            <div id="sipp" class="value">£0</div>
        </div>
        <div class="card">
            <div class="label">Liquid Cash</div>
            <div id="cash" class="value">£0</div>
        </div>
        <div class="card">
            <div class="label">Gold & Assets</div>
            <div id="gold" class="value">£0</div>
        </div>
        <div class="card">
            <div class="label">Mortgage Balance</div>
            <div id="mortgage" class="value mortgage">£0</div>
        </div>
        <div class="card">
            <div class="label">FIRE Progress</div>
            <div id="fire" class="value">0%</div>
        </div>
    </div>

    <div class="footer">
        <p id="sync-info">Last Updated: ---</p>
    </div>
</div>

<script>
    // VERIFIED CSV LINK (ENSURE THIS IS PUBLISHED AS CSV)
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQQ53qpxLKc_IIHcFEZAJTKfxHF0JvqKHUylAUojLpXgmMoXbHwrjFZOW8Ckz4TGnp33-5AHkvtH01_/pub?output=csv';

    function init() {
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                const data = results.data[0];
                console.log("Verified Data:", data);

                // BULLETPROOF CLEANING FUNCTION
                const fNum = (val, isPct = false) => {
                    if (!val || val.includes('#') || val === '-') return isPct ? "0%" : "£0";
                    let clean = val.toString().replace(/[£,%]/g, '').trim();
                    let num = parseFloat(clean);
                    if (isNaN(num)) return isPct ? "0%" : "£0";
                    
                    if(isPct) return num.toFixed(1) + "%";
                    return (num < 0 ? "-£" : "£") + Math.abs(num).toLocaleString();
                };

                // UPDATING THE DOM
                document.getElementById('nw').innerText = fNum(data.NetWorth);
                document.getElementById('sipp').innerText = fNum(data.SIPP);
                document.getElementById('cash').innerText = fNum(data.Cash);
                document.getElementById('gold').innerText = fNum(data.Gold);
                document.getElementById('mortgage').innerText = fNum(data.Mortgage);
                document.getElementById('fire').innerText = fNum(data.FIRE_Pct, true);
                
                document.getElementById('sync-info').innerText = "Last Bible Sync: " + (data.LastSync || "Just Now");
                document.getElementById('loading-overlay').style.display = 'none';
            },
            error: function(err) {
                document.getElementById('loading-overlay').innerText = "Sync Error: Check CSV Link";
            }
        });
    }

    window.onload = init;
</script>
</body>
</html>
